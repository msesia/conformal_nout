---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# nout

<!-- badges: start -->
<!-- badges: end -->

The R package ***nout*** implements ACODE, an Automatic Conformal Outlier Detection and Enumeration method, that enables the Closed Testing method with two-sample rank tests applied to univariate conformity scores, which can be generated by any model trained to distinguish outliers from inliers. 

It offers a data-driven solution to (i) select the most effective classification algorithm, among both one-class and binary classifiers, for computing conformity scores and (ii) the most suitable testing procedures. Thanks to split-conformal techniques it is protected against selection bias.


## Installation

You can install the development version of nout from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("msesia/conformal_nout")
```

## Example

This is a basic example on synthetic data:

```{r example}
library(nout)

set.seed(321)

# Auxiliary functions to generate scores
g2 = function(x, k=2) ifelse(x<1 & x>0, k*x^(k-1), 0)
rg2 = function(rnull, k=2) max(rnull(k))

# Generating calibration and test score vectors
# Outlier distribution is the Lehmann's alternative of order k=2
X = runif(20)
Y = replicate(20, rg2(rnull=runif))



# Confidence lower-bound for the number of outliers using Closed Testing with local Simes test
res1 = d_selection_simes(X, Y,alpha = 0.1)

# Confidence lower-bound for the number of outliers using Closed Testing with local Fisher's method
res2 = d_selection_fisher(X, Y, B=100, n_perm=0, alpha=0.1)

# Confidence lower-bound for the number of outliers using Closed Testing with local Wilcoxon sum-rank test 
res3 = d_selection_higher(X, Y, local_test="WMW", n_perm=0, B=100, alpha=0.1)

# Confidence lower-bound for the number of outliers using Closed Testing with local higher order Wilcoxon sum-rank test of order k=2
res4 = d_selection_higher(X, Y, local_test="higher", k=2, n_perm=0, B=100, alpha=0.1)

# Confidence lower-bound for the number of outliers using Closed Testing with local oracle Shiraishi test
res5 = d_selection_G(X, Y, g.hat = g2, monotonicity="increasing", B=100, alpha=0.1)

```


## References

Bates, S., E. Candes, L. Lei, Y. Romano, and M. Sesia (2023). Testing for outliers with conformal p-values. \textit{Ann. Stat.} {\bf 51}, 149–178.

Fisher, R. A. (1925). Statistical methods for research workers. In \textit{Breakthroughs in statistics: Methodology and distribution}, pp. 66–70. Springer.

Goeman, J. J. and A. Solari (2011). Multiple testing for exploratory research. \textit{Stat. Sci.} {\bf 26}, 584–597.

Lehmann, E. L. (1953). The power of rank tests.  \textit{Ann. Math. Stat.} {\bf 24}, 23–42.

Magnani, C. G., Sesia, M. and Solari, A. (2024) Collective Outlier Detection and Enumeration with Conformalized Closed Testing. \textit{arXiv preprint arXiv:2308.05534}

Liang, Z., M. Sesia, and W. Sun (2024). Integrative conformal p-values for out-of-distribution testing with labelled outliers. \textit{J. R. Stat. Soc. B}, qkad138. 

Mann, H. B. and D. R. Whitney (1947). On a test of whether one of two random variables is stochastically larger than the other. \textit{Ann. Math. Stat.} {\bf 18}, 50– 60.

Marandon, A., L. Lei, D. Mary, and E. Roquain (2024). Adaptive novelty detection with false discovery rate guarantee. \textit{Ann. Stat.} {\bf 52}, 157–183.

Shiraishi, T. (1985). Local powers of two-sample and multi-sample rank tests for lehmann’s contaminated alternative. \textit{Ann. Inst. Stat. Math.} {\bf 37}, 519–527.

Wilcoxon, F. (1945). Individual comparisons by ranking methods. \textit{Biometrics Bulletin} {\bf 1}, 80–83.

<!--You'll still need to render `README.Rmd` regularly, to keep `README.md` up-to-date. `devtools::build_readme()` is handy for this. You could also use GitHub Actions to re-render `README.Rmd` every time you push. An example workflow can be found here: <https://github.com/r-lib/actions/tree/v1/examples>. -->

<!-- You can also embed plots, for example: -->

<!-- ```{r pressure, echo = FALSE} -->
<!-- plot(pressure) -->
<!-- ``` -->

<!-- In that case, don't forget to commit and push the resulting figure files, so they display on GitHub and CRAN. -->
